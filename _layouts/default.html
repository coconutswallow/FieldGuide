<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title | default: site.title }}</title>
    <link rel="stylesheet" href="{{ '/assets/css/statblock.css' | relative_url }}">
</head>
<body>
    <!-- Header: This is the ONLY place the site header should be defined. -->
    <header class="site-header">
        <div class="header-content">
            <!-- Hamburger Menu Button (Must exist here to be functional on ALL pages) -->
            <button id="menu-toggle" aria-label="Toggle Navigation Menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </button>
            <h1 class="site-title">{{ site.title | default: "Hawthorne Field Guide" }}</h1>
             <!-- Standard Desktop Navigation -->
            <nav class="site-nav">
                <a href="{{ site.baseurl }}/">Home</a>
                <a href="{{ site.baseurl }}/monsters/">Monsters</a>
                <a href="{{ site.baseurl }}/about/">About</a>
            </nav>
        </div>
    </header>

    <!-- OFF-CANVAS SIDEBAR MENU (Must exist ONLY here) -->
    <div id="sidebar-menu">
        <div class="sidebar-header">
            <h4 class="sidebar-title">Hawthorne Field Guide</h4>
            <button id="close-menu-btn" class="close-btn" aria-label="Close Menu">&times;</button>
        </div>
        <!-- Navigation links for the sidebar -->
        <div class="sidebar-nav">
            <a href="{{ site.baseurl }}/">Home</a>
            <a href="https://sites.google.com/view/hawthorne-players-guide">Hawthorne Player's Guide</a>
            <a href="https://drive.google.com/file/d/1MiXp60GBg2ZASiiGjgFtTRFHp7Jf0m2P/view?usp=sharing">Hawthorne DM's Guide</a>
        </div>
    </div>

    <!-- Menu Overlay for Click-to-Close -->
    <div id="menu-overlay"></div>

    <div class="page">
        {{ content }}
    </div>

    <footer class="site-footer">
        <div class="footer-content">
            <p>&copy; {{ 'now' | date: "%Y" }} {{ site.title | default: "Hawthorne Field Guide" }}</p>
            <p>Created for personal D&D campaigns</p>
        </div>
    </footer>
    
    <!-- JAVASCRIPT FOR MENU INTERACTION (Must exist ONLY here to prevent ID conflicts) -->
    <script>
        const menuToggle = document.getElementById('menu-toggle');
        const sidebarMenu = document.getElementById('sidebar-menu');
        const closeBtn = document.getElementById('close-menu-btn');
        const menuOverlay = document.getElementById('menu-overlay');
        const body = document.body;

        // Function to handle opening and closing the menu
        function toggleMenu() {
             // Basic guard clause to ensure elements exist
             if (!sidebarMenu || !menuOverlay) return; 
            const isOpen = sidebarMenu.classList.toggle('open');
            menuOverlay.classList.toggle('open');
            // 'menu-open' class prevents background content from scrolling
            body.classList.toggle('menu-open', isOpen);
        }

        // Attach listeners
        if (menuToggle) {
            menuToggle.addEventListener('click', toggleMenu);
        }
        
        // Attach listeners for closing the menu
        if (closeBtn) {
            closeBtn.addEventListener('click', toggleMenu);
        }
        
        if (menuOverlay) {
            menuOverlay.addEventListener('click', toggleMenu);
        }
        
        // Closes the menu if the screen is resized to desktop size while the menu is open
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768 && sidebarMenu && sidebarMenu.classList.contains('open')) {
                // Use a short delay for smooth execution after resize event
                setTimeout(toggleMenu, 50); 
            }
        });
    </script>
</body>
</html>